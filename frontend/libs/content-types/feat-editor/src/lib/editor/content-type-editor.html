<h1 class="text-2xl font-bold" id="pageTitle">{{ title() }}</h1>

<form class="mt-8 grid grid-cols-1 items-start gap-6 md:grid-cols-2" [formGroup]="form" aria-labelledby="pageTitle">


	@let kindCollectionId = 'kindCollection' | uniqueId;
	@let kindSingleId = 'kindSingle' | uniqueId;
	<fieldset class="rounded-border border-surface-200 bg-surface-0 border p-4 row-start-1 row-end-3" role="radiogroup">
		<legend class="text-surface-600 mb-3 text-sm font-medium">Type</legend>
		<div class="flex flex-col gap-2">
			<div class="flex items-center gap-3">
				<p-radio-button [formControl]="form.controls.kind" [inputId]="kindCollectionId" value="collection"/>
				<label class="cursor-pointer" [for]="kindCollectionId">Collection type</label>
			</div>
			<div class="flex items-center gap-3">
				<p-radio-button [formControl]="form.controls.kind" [inputId]="kindSingleId" value="singleton"/>
				<label class="cursor-pointer" [for]="kindSingleId">Single type</label>
			</div>
		</div>
	</fieldset>


	<ui-form-field floatingLabel class="block w-2xs" label="Name">
		<input class="w-2xs" [pKeyFilter]="kebabChar"  formControlName="name" pInputText autocomplete="off"/>
	</ui-form-field>

	@if (contentTypeId()) {
		<p-button
			styleClass="w-2xs"
			severity="success"
			variant="outlined"
			label="Update"
			type="button"
			[loading]="update.isPending()"
			(onClick)="updateContentType()"
			[disabled]="form.invalid || form.pristine || update.isPending()"
		/>

	}

	<section
		class="rounded-border border-surface-200 bg-surface-0 col-span-full border p-4"
		aria-labelledby="fieldsHeading"
	>
		<h2 class="text-surface-800 text-lg font-semibold" id="fieldsHeading">Fields</h2>
		<ul class="mt-4 grid grid-cols-[repeat(auto-fill,minmax(16rem,1fr))] gap-4" role="list">
			@for (field of fields.value; track field.id) {

				<li class="min-w-0">
					<a
						[routerLink]="[{ outlets: { field: [field.id] } }]"
						class="rounded-border border-surface-200 bg-surface-0 hover:border-primary-300 focus:ring-primary-200 block border p-4 shadow-sm transition-shadow hover:shadow-md focus:ring-2 focus:outline-none"
					>
						<div class="flex items-start justify-between">
							<span class="text-surface-900 font-medium">{{ field.label || field.name }}</span>
							<span
								class="bg-primary-50 text-primary-700 border-primary-200 rounded-full border px-2 py-1 text-xs"
							>{{ fieldTypeNames[field.type] }}</span
							>
						</div>
						<div class="text-surface-500 mt-2 text-xs">
							@if (field.isRequired) {
								<span class="text-red-500">Required</span>
							} @else {
								<span>Optional</span>
							}
						</div>
					</a>
				</li>

			}

			<li class="col-span-full">
				<a
					[routerLink]="[{ outlets: { field: ['new'] } }]"
					class="rounded-border border-primary-300 bg-primary-50/50 hover:bg-emphasis flex cursor-pointer flex-col items-center justify-center gap-2 border border-dashed p-4 shadow-sm transition-shadow hover:shadow-md"
					aria-label="Add a new field"
				>
					<span class="pi pi-plus-circle text-primary-600 text-xl" aria-hidden="true"></span>
					<span class="text-surface-500">Add field</span>
				</a>
			</li>
		</ul>
	</section>

	<div class="col-span-full flex justify-between pt-2">
		<div>
			@if (contentTypeId()) {
				<p-button
					severity="danger"
					label="Delete"
					variant="outlined"
					styleClass="min-w-28"
					type="button"
					[loading]="remove.isPending()"
					(onClick)="onDelete()"
				/>
			}
		</div>

		@if (!contentTypeId()) {
			<p-button
				styleClass="min-w-28"
				label="Create"
				(onClick)="createContentType()"
				[loading]="create.isPending()"
				[disabled]="form.invalid || form.pristine"
			/>

		}
	</div>
</form>

<p-drawer
	[visible]="outlet.isActivated"
	header="Field editor"
	(onHide)="hideOutlet()"
	position="right"
	[modal]="true"
	[blockScroll]="true"
	[dismissible]="true"
	[style]="{ width: '28rem' }"
	aria-modal="true"
	role="dialog"
>
	<router-outlet name="field" #outlet="outlet"/>
</p-drawer>


<p-confirmdialog [key]="contentTypeId()" position="top"/>